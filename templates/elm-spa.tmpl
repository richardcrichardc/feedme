<!DOCTYPE html>
<html>
  <head>
    <title>Feedme</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{{ asset "feedme.css" }}">

    <script src="{{ asset "elm.js" }}"></script>
  </head>

  <body>
    <div id="elm-container">
    </div>

    <script type="text/javascript" charset="utf-8">
      var node = document.getElementById('elm-container')
      var flags = {{.Flags}}
      var elmApp = Elm.{{.App}}.embed(node, flags)

      elmApp.ports.scrollIntoView.subscribe(scrollIntoView)

      function scrollIntoView(domId, time) {
        time = time || 0;
        if (time < 500) {
          var el = document.getElementById(domId)
          if (el) {
            el.scrollIntoView()
          } else {
            setTimeout(function() { scrollIntoView(domId, time+10), 0})
          }
        }
      }

      window.onscroll = function() {
        var bodyRect = document.body.getBoundingClientRect()
        var menuDiv = document.getElementById('menu')
        var yPosition = window.pageYOffset || document.body.scrollTop
        var menuTop = 0
        var menuHeight = 0

        if (menuDiv) {
          var menuRect = menuDiv.getBoundingClientRect()
          menuTop = menuRect.y - bodyRect.y
          menuHeight = menuRect.height
        }

        elmApp.ports.scrollPosition.send([yPosition, menuTop, menuHeight]);
      }
    </script>
  </body>
</html>
